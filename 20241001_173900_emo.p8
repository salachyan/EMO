pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- constants for collision flag
ground_flag = 0  -- the flag we set for the ground (sprite 005)

function _init()
  -- initialize player properties
  player = {
    x = 64,     -- starting x position
    y = 64,     -- starting y position
    sp = 1,     -- top-left corner of the 4x4 sprite (32x32 pixels)
    w = 32,     -- width of the sprite in pixels
    h = 32,     -- height of the sprite in pixels
    dx = 0,     -- horizontal movement speed
    dy = 0,     -- vertical movement speed (for jumping/falling)
    speed = 2,  -- movement speed
   -- gravity = 0.3, --  strength
    flip = false, -- direction of the sprite
    is_on_ground = false -- player grounded state
  }
end

function _update()
  -- reset player horizontal movement speed
  player.dx = 0

  -- move left
  if btn(⬅️) then
    player.dx = -player.speed
    player.flip = true -- flip sprite to face left
  end

  -- move right
  if btn(➡️) then
    player.dx = player.speed
    player.flip = false -- face sprite to the right
  end

  -- apply gravity
 -- player.dy = player.dy + player.gravity

  -- check for ground collision (using flag 0) for a 16x16 region
  if is_colliding_with_ground(player.x, player.y + player.h) then
    player.dy = 0
    player.is_on_ground = true
  else
    player.is_on_ground = false
  end

  -- update player position
  player.x = player.x + player.dx
  player.y = player.y + player.dy
end

function _draw()
  -- clear screen
  cls()

  -- draw the map (starting at tile (0,0), filling the screen)
  map(0, 0, 0, 0, 16, 16)

  -- draw the player sprite (32x32 pixels = 4 tiles by 4 tiles)
  spr(player.sp, player.x, player.y, 4, 4, player.flip)
end

-- function to check if a point collides with ground (sprite 005)
function is_colliding_with_ground(x, y)
  -- convert x and y to tile coordinates for a 16x16 region
  local tile_x1 = flr(x / 16) * 2
  local tile_y1 = flr(y / 16) * 2

  -- check collision for a 2x2 grid of 8x8 tiles (which forms a 16x16 area)
  for i = 0, 1 do
    for j = 0, 1 do
      local tile_x = tile_x1 + i
      local tile_y = tile_y1 + j
      local tile = mget(tile_x, tile_y)
      -- check if this tile has the ground_flag (for sprite 005)
      if fget(tile, ground_flag) then
        return true  -- ground collision detected
      end
    end
  end
  return false  -- no collision
end

__gfx__
0000000000000000000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
0000000000444400000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
0070070004f1f140000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
00077000f4ffef4f000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
0007700004444440000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
00700700004ff400000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
00000000044ff440000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
0000000000400400000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000000000000000000000000000cccccccccccccccccccccccccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000000011111111100000000000cccccccccccc000000000ccccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000000144444444410000000000ccccccccccc04444444440cccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000001444444444441000000000cccccccccc0444444444440ccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000014444444444444100000000ccccccccc044444444444440cccccccc33333333333333333333333333333333000000000000000000000000
00000000000000111144fff44444ff4111100000cccccc000044fff44444ff40000ccccc33333333333333333333333333333333000000000000000000000000
00000000000001fff14ff1ff444f1f41fff10000ccccc0fff04ff0ff444f0f40fff0cccc33333333333333333333333333333333000000000000000000000000
00000000000001fff14ff1ffffff1f41fff10000ccccc0fff04ff0ffffff0f40fff0cccc33333333333333333333333333333333000000000000000000000000
0000000000000011114fffff11ffff4111100000cccccc00004fffff00ffff40000ccccc33333333333333333333333333333333000000000000000000000000
0000000000000000014fffffffffff4100000000ccccccccc04fffffffffff40cccccccc33333333333333333333333333333333000000000000000000000000
00000000000000000014ffffffffff1000000000cccccccccc04ffffffffff0ccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000000111444441110000000000ccccccccccc00044444000cccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000011000014444444100000000000cccccc00cccc044444440ccccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000100100144444444410000000000ccccc0cc0cc04444444440cccccccccc33333333333333333333333333333333000000000000000000000000
00000000000001000001444fff44410000000000ccccc0ccccc0444fff4440cccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000010001444fffff4441000000000cccccc0ccc0444fffff4440ccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000001001444fffff4441000000000ccccccc0cc0444fffff4440ccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000111444fffff4441000000000cccccccc000444fffff4440ccccccccc33333333333333333333333333333333000000000000000000000000
00000000000000000011144fff44110000000000cccccccccc00044fff4400cccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000000014411144100000000000cccccccccccc044000440ccccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000000014100014100000000000cccccccccccc040ccc040ccccccccccc33333333333333333333333333333333000000000000000000000000
0000000000000000000011000001100000000000cccccccccccc00ccccc00ccccccccccc33333333333333333333333333333333000000000000000000000000
__map__
0707070707070707070707070707070706060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070706060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070706060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070706060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070706060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b06060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070706060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070706060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070706060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070707070707060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050705050505050505050505050505050706060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505060606060606060606060606060606060606060606060606060606060606060606060606060606060606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
